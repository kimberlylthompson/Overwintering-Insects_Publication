<<<<<<< HEAD
######################################################################################
###########      Supercooling point - Reclassifying and calculating   ################
###########         the extent the ground temp went below             ################
###########                 the SCP of the Wooly Bear                 ################
######################################################################################

# Author: Kimberly Thompson

# This script calculates the extent below the upper limit of the supercooling
# point for woolly bears - WORST-CASE scenario, for 3 different treatments:
# external / current conditions, +3C, and +5C.

# This done for the mean, median, min and max predicted values of ground temperatures
# however only the mean is used in the analysis.

# Dataset produced:
# Wooly Bear_Extent_Worst Case Scenario.csv



# Clear workspace
rm(list = ls() ) 
gc() #releases memory

library(raster)
library(sp)
library(lubridate)


#########################################################################
#############              Changing Cell values          ################
#########################################################################

# Wooly bear caterpillar - The range of SCP values found by Layne et al. (1999) was similar to that found by 
# Marshall and Sinclair (2011) during the second year of their study; however, given the lower SCP results in the
# second year of the study, we used this value for a conservative estimate of the sensitivity of woolly bear 
# caterpillars to changes in the subnivium. --> -6.3 AS A WORST CASE VALUE


# From the corrected dailies predictions of minimum temperature, read in each file, and resample so that if the values
# are -6.3 or above, the cell gets a 0, if the value is lower than -6.3 it gets a 1.


# Create sum function that would not take into account NAs


sum.na <- function (x) {
  sum(x, na.rm=TRUE)
}




#############################
#######  External  ##########
#############################

# In the duration analysis I calculated the mean, median, min, and max,
# but here for the extent analysis I will only do the mean


# Path of the summary folders
# base.path <- "Y:/kthompson/Ch 4 Bumblebees/Spatial Predictions/Corrected Daily Summaries/External/"
path <- "01_Analysis/Spatial Predictions/Summaries/External"
# path <- "G:/My Drive/Ch 4 Bumblebees/Analysis/Results/Spatial Predictions/External/Corrected Daily Summary Mean/Mean/"
Treatment.list <- list.files(path, pattern = "M")


# Make a blank raster to store the altered layers in
newstack <- stack()

for (i in 1:length(Treatment.list)) {
  
  # Read in the daily raster
  setwd(path)
  subniv <- raster :: raster(Treatment.list[[i]])
  
  # Reclassify the raster
  subniv[subniv >= -6.3] <- 0
  subniv[subniv < -6.3] <- 1
  
  # Add the reclassified layer to the blank raster stack for this treatment
  newstack <- addLayer(newstack, subniv)
  
  print(i)
  
}


# Create a dataframe to store values
extent.df_ext <- data.frame(day = character(), value = integer())

# For each layer in the stack, sum the 1's to get the extent in square
# kilometers of variability
for (i in 1:nlayers(newstack)) {
  day <- substr(names(newstack[[i]]), 7, 11)
  value <- sum.na(values(newstack[[i]]))
  
  extent.df_ext <- rbind(extent.df_ext,
                         cbind(day, value))
  print(i)
  
}



# Clean up workspace before beginning on next treament
rm(path, newstack, subniv, Treatment.list)


#############################
#######   House 3  ##########
#############################

# Path of the summary folders
# base.path <- "Y:/kthompson/Ch 4 Bumblebees/Spatial Predictions/Corrected Daily Summaries/External/"
path <- "01_Analysis/Spatial Predictions/Summaries/House 3"
# path <- "G:/My Drive/Ch 4 Bumblebees/Analysis/Results/Spatial Predictions/Corrected House 3/Corrected Daily Summary Mean/"
Treatment.list <- list.files(path, pattern = "M")


# Make a blank raster to store the altered layers in
newstack <- stack()

# Reclassify
for (i in 1:length(Treatment.list)) {
  
  # Read in the daily raster
  setwd(path)
  subniv <- raster :: raster(Treatment.list[[i]])
  
  # Reclassify the raster
  subniv[subniv >= -6.3] <- 0
  subniv[subniv < -6.3] <- 1
  
  # Add the reclassified layer to the blank raster stack for this treatment
  newstack <- addLayer(newstack, subniv)
  
  print(i)
  
}


# Create a dataframe to store values
extent.df_h3 <- data.frame(day = character(), value = integer())

# For each layer in the stack, sum the 1's to get the extent in square
# kilometers of variability
for (i in 1:nlayers(newstack)) {
  day <- substr(names(newstack[[i]]), 7, 11)
  value <- sum.na(values(newstack[[i]]))
  
  extent.df_h3 <- rbind(extent.df_h3,
                         cbind(day, value))
  print(i)
  
}



# Clean up workspace before beginning on next treament
rm(path, newstack, subniv, Treatment.list, day, i, value)




#############################
#######   House 5  ##########
#############################

# Path of the summary folders
# base.path <- "Y:/kthompson/Ch 4 Bumblebees/Spatial Predictions/Corrected Daily Summaries/External/"
path <- "01_Analysis/Spatial Predictions/Summaries/House 5"
#path <- "G:/My Drive/Ch 4 Bumblebees/Analysis/Results/Spatial Predictions/Corrected House 5/Corrected Daily Summary Mean/"
Treatment.list <- list.files(path, pattern = "M")


# Make a blank raster to store the altered layers in
newstack <- stack()

# Reclassify
for (i in 1:length(Treatment.list)) {
  
  # Read in the daily raster
  setwd(path)
  subniv <- raster :: raster(Treatment.list[[i]])
  
  # Reclassify the raster
  subniv[subniv >= -6.3] <- 0
  subniv[subniv < -6.3] <- 1
  
  # Add the reclassified layer to the blank raster stack for this treatment
  newstack <- addLayer(newstack, subniv)
  
  print(i)
  
}


# Create a dataframe to store values
extent.df_h5 <- data.frame(day = character(), value = integer())

# For each layer in the stack, sum the 1's to get the extent in square
# kilometers of variability
for (i in 1:nlayers(newstack)) {
  day <- substr(names(newstack[[i]]), 7, 11)
  value <- sum.na(values(newstack[[i]]))
  
  extent.df_h5 <- rbind(extent.df_h5,
                        cbind(day, value))
  print(i)
  
}



# Clean up workspace before beginning on next treament
rm(path, newstack, subniv, Treatment.list, day, i, value)


# Combine dataframes
extent.df_ext$Type <- "external"
extent.df_h3$Type <- "H3"
extent.df_h5$Type <- "H5"

wooly.worst <- rbind(extent.df_ext, extent.df_h3, extent.df_h5)

# Save df
setwd("01_Analysis/Spatial Predictions/Species Vulnerability/Extent")
# setwd("G:/My Drive/Ch 4 Bumblebees/Analysis/Results/Spatial Predictions/Species Sensitivities/Y - Extent Analysis")
write.csv(wooly.worst, "Wooly Bear_Worst Case Scenario.csv", row.names = FALSE)
=======
######################################################################################
###########      Supercooling point - Reclassifying and calculating   ################
###########         the extent the ground temp went below             ################
###########                 the SCP of the Wooly Bear                 ################
######################################################################################

# Author: Kimberly Thompson

# This script calculates the extent below the upper limit of the supercooling
# point for woolly bears - WORST-CASE scenario, for 3 different treatments:
# external / current conditions, +3C, and +5C.

# This done for the mean, median, min and max predicted values of ground temperatures
# however only the mean is used in the analysis.

# Dataset produced:
# Wooly Bear_Extent_Worst Case Scenario.csv



# Clear workspace
rm(list = ls() ) 
gc() #releases memory

library(raster)
library(sp)
library(lubridate)


#########################################################################
#############              Changing Cell values          ################
#########################################################################

# Wooly bear caterpillar - The range of SCP values found by Layne et al. (1999) was similar to that found by 
# Marshall and Sinclair (2011) during the second year of their study; however, given the lower SCP results in the
# second year of the study, we used this value for a conservative estimate of the sensitivity of woolly bear 
# caterpillars to changes in the subnivium. --> -6.3 AS A WORST CASE VALUE


# From the corrected dailies predictions of minimum temperature, read in each file, and resample so that if the values
# are -6.3 or above, the cell gets a 0, if the value is lower than -6.3 it gets a 1.


# Create sum function that would not take into account NAs


sum.na <- function (x) {
  sum(x, na.rm=TRUE)
}




#############################
#######  External  ##########
#############################

# In the duration analysis I calculated the mean, median, min, and max,
# but here for the extent analysis I will only do the mean


# Path of the summary folders
# base.path <- "Y:/kthompson/Ch 4 Bumblebees/Spatial Predictions/Corrected Daily Summaries/External/"
path <- "01_Analysis/Spatial Predictions/Summaries/External"
# path <- "G:/My Drive/Ch 4 Bumblebees/Analysis/Results/Spatial Predictions/External/Corrected Daily Summary Mean/Mean/"
Treatment.list <- list.files(path, pattern = "M")


# Make a blank raster to store the altered layers in
newstack <- stack()

for (i in 1:length(Treatment.list)) {
  
  # Read in the daily raster
  setwd(path)
  subniv <- raster :: raster(Treatment.list[[i]])
  
  # Reclassify the raster
  subniv[subniv >= -6.3] <- 0
  subniv[subniv < -6.3] <- 1
  
  # Add the reclassified layer to the blank raster stack for this treatment
  newstack <- addLayer(newstack, subniv)
  
  print(i)
  
}


# Create a dataframe to store values
extent.df_ext <- data.frame(day = character(), value = integer())

# For each layer in the stack, sum the 1's to get the extent in square
# kilometers of variability
for (i in 1:nlayers(newstack)) {
  day <- substr(names(newstack[[i]]), 7, 11)
  value <- sum.na(values(newstack[[i]]))
  
  extent.df_ext <- rbind(extent.df_ext,
                         cbind(day, value))
  print(i)
  
}



# Clean up workspace before beginning on next treament
rm(path, newstack, subniv, Treatment.list)


#############################
#######   House 3  ##########
#############################

# Path of the summary folders
# base.path <- "Y:/kthompson/Ch 4 Bumblebees/Spatial Predictions/Corrected Daily Summaries/External/"
path <- "01_Analysis/Spatial Predictions/Summaries/House 3"
# path <- "G:/My Drive/Ch 4 Bumblebees/Analysis/Results/Spatial Predictions/Corrected House 3/Corrected Daily Summary Mean/"
Treatment.list <- list.files(path, pattern = "M")


# Make a blank raster to store the altered layers in
newstack <- stack()

# Reclassify
for (i in 1:length(Treatment.list)) {
  
  # Read in the daily raster
  setwd(path)
  subniv <- raster :: raster(Treatment.list[[i]])
  
  # Reclassify the raster
  subniv[subniv >= -6.3] <- 0
  subniv[subniv < -6.3] <- 1
  
  # Add the reclassified layer to the blank raster stack for this treatment
  newstack <- addLayer(newstack, subniv)
  
  print(i)
  
}


# Create a dataframe to store values
extent.df_h3 <- data.frame(day = character(), value = integer())

# For each layer in the stack, sum the 1's to get the extent in square
# kilometers of variability
for (i in 1:nlayers(newstack)) {
  day <- substr(names(newstack[[i]]), 7, 11)
  value <- sum.na(values(newstack[[i]]))
  
  extent.df_h3 <- rbind(extent.df_h3,
                         cbind(day, value))
  print(i)
  
}



# Clean up workspace before beginning on next treament
rm(path, newstack, subniv, Treatment.list, day, i, value)




#############################
#######   House 5  ##########
#############################

# Path of the summary folders
# base.path <- "Y:/kthompson/Ch 4 Bumblebees/Spatial Predictions/Corrected Daily Summaries/External/"
path <- "01_Analysis/Spatial Predictions/Summaries/House 5"
#path <- "G:/My Drive/Ch 4 Bumblebees/Analysis/Results/Spatial Predictions/Corrected House 5/Corrected Daily Summary Mean/"
Treatment.list <- list.files(path, pattern = "M")


# Make a blank raster to store the altered layers in
newstack <- stack()

# Reclassify
for (i in 1:length(Treatment.list)) {
  
  # Read in the daily raster
  setwd(path)
  subniv <- raster :: raster(Treatment.list[[i]])
  
  # Reclassify the raster
  subniv[subniv >= -6.3] <- 0
  subniv[subniv < -6.3] <- 1
  
  # Add the reclassified layer to the blank raster stack for this treatment
  newstack <- addLayer(newstack, subniv)
  
  print(i)
  
}


# Create a dataframe to store values
extent.df_h5 <- data.frame(day = character(), value = integer())

# For each layer in the stack, sum the 1's to get the extent in square
# kilometers of variability
for (i in 1:nlayers(newstack)) {
  day <- substr(names(newstack[[i]]), 7, 11)
  value <- sum.na(values(newstack[[i]]))
  
  extent.df_h5 <- rbind(extent.df_h5,
                        cbind(day, value))
  print(i)
  
}



# Clean up workspace before beginning on next treament
rm(path, newstack, subniv, Treatment.list, day, i, value)


# Combine dataframes
extent.df_ext$Type <- "external"
extent.df_h3$Type <- "H3"
extent.df_h5$Type <- "H5"

wooly.worst <- rbind(extent.df_ext, extent.df_h3, extent.df_h5)

# Save df
setwd("01_Analysis/Spatial Predictions/Species Vulnerability/Extent")
# setwd("G:/My Drive/Ch 4 Bumblebees/Analysis/Results/Spatial Predictions/Species Sensitivities/Y - Extent Analysis")
write.csv(wooly.worst, "Wooly Bear_Worst Case Scenario.csv", row.names = FALSE)
>>>>>>> f71b9b43c2ce4a4993c0575a12ed45b45c29af71
