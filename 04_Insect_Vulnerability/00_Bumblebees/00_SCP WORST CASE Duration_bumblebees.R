<<<<<<< HEAD
######################################################################################
###########      Supercooling point - Reclassifying and calculating   ################
###########         the # of days the ground temp went below          ################
###########                 the SCP of bumblebees                     ################
######################################################################################

# Author: Kimberly Thompson

# This script calculates the number of days below the upper limit of the supercooling
# point for Bombus terrestis - WORST-CASE scenario, for 3 different treatments:
# external / current conditions, +3C, and +5C.

# This done for the mean, median, min and max predicted values of ground temperatures
# however only the mean is used in the analysis.

# Rasters produced:
# "SCP_Bombus_Worst Case_Mean_External.tif"
# "SCP_Bombus_Worst Case_Mean_3C warmer.tif"
# "SCP_Bombus_Worst Case_Mean_5C warmer.tif"

# Clear workspace
rm(list = ls() ) 
gc() #releases memory

library(raster)
library(sp)
library(lubridate)


#########################################################################
#############              Changing Cell values          ################
#########################################################################

# From Owen et al. 2013, the SCP of Bombus terrestris audax queens was found to be -7C +/- 0.3. 
# worst case is -6.7

# From the corrected dailies predictions of minimum temperature, read in each file, and resample so that if the values
# are -6.7 or above, the cell gets a 0, if the value is lower than -6.7 it gets a 1.

# Create sum function that would not take into account NAs


sum.na <- function (x) {
  sum(x, na.rm=TRUE)
}



#### Read in the separating lakes file ###
setwd("01_Analysis/Spatial Predictions")
# setwd("Y:/kthompson/Ch 4 Bumblebees/Spatial Predictions/Species Sensitivities")
separating.lakes <- read.csv("Separating Lakes.csv", header = TRUE)






#############################
#######  External  ##########
#############################

# Since I have 4 different measures to do this for (mean, median, min, and max [of the 50 bootstrapped samples for daily
# minimum temperature]), make a loop

# Path of the summary folders
base.path <- "01_Analysis/Spatial Predictions/Summaries/External"
# base.path <- "Y:/kthompson/Ch 4 Bumblebees/Spatial Predictions/Corrected Daily Summaries/External/"
base.list <- list.files(base.path, pattern = "M")

# Path to write resulting raster stacks and final raster
write.path <- "01_Analysis/Spatial Predictions/Species Vulnerability/Bumblebees"
# write.path <- "Y:/kthompson/Ch 4 Bumblebees/Spatial Predictions/Species Sensitivities/Bumblebees/Worst Case/"


# Determining sensitivity based on SCP
start.time <- Sys.time()

for (j in 1:4) { # Number of summary measures to calculate for
  
  path <- paste(base.path, base.list[[j]], sep = "")
  Treatment.list <- list.files(path, pattern = "X")
  
  # Make a blank raster to store the altered layers in
  newstack <- stack()
  
  for (i in 1:length(Treatment.list)) {
    
    # Read in the daily raster
    setwd(path)
    subniv <- raster :: raster(Treatment.list[[i]])
    
    # Reclassify the raster
    subniv[subniv >= -6.7] <- 0
    subniv[subniv < -6.7] <- 1
    
    # Add the reclassified layer to the blank raster stack for this treatment
    newstack <- addLayer(newstack, subniv)
    
    print(i)
    
  }

  # I have this in here to be thorough but I don't think I need to have the whole raster stack written
  # It takes a huge amount of processing time to write such large stacks
  # Write the resulting raster stack
  # setwd(paste(write.path, "Reclassified Stacks", sep=""))
  # writeRaster(newstack, paste("SCP_Bombus_", base.list[[j]], "_External Daily Stack.tif", sep = ""), overwrite = TRUE)

  
  # Sum all of the layers to get a spatially-explicit measure of how many days the temps was below the SCP
  # Each cell's values will represent the number of days that the temp was below the SCP
  # true lakes which would have NA values for all days will have value of 0 which is incorrect though
  duration <- overlay(newstack, fun=sum.na)
  
  # Convert duration to a dataframe
  duration.dataframe <- as.data.frame(duration, xy=TRUE)
  
  # Merge the two dataframes together
  df <- merge(duration.dataframe, separating.lakes, by.x = c("x", "y"), by.y = c("x", "y"), all=TRUE)
  
  # Change layer.x value to NA where layer.y value is 605
  df$layer.x[df$layer.y == 6050] <- NA

  # Remove layer.y column
  df$layer.y <- NULL
  
  # Convert this dataframe to a raster
  # create spatial points data frame
  spg <- df
  coordinates(spg) <- ~ x + y
  # coerce to SpatialPixelsDataFrame
  gridded(spg) <- TRUE
  # coerce to raster
  rasterDF <- raster(spg)
  
  # Define the coordinate system
  crs(rasterDF) <- "+proj=aea +lat_0=23 +lon_0=-96 +lat_1=29.5 +lat_2=45.5 +x_0=0 +y_0=0 +ellps=GRS80 +datum=WGS84 +units=m +no_defs"
  
  # Write the resulting raster layer
  setwd(write.path)
  writeRaster(rasterDF, paste("SCP_Bombus_Worst Case_", base.list[[j]], "_External.tif", sep = ""), overwrite = TRUE)
  
  print(j)
  
} # Close j loop

end.time <- Sys.time()
end.time - start.time
  

# Clean up workspace before beginning on next treament
rm(base.list, base.path, duration, newstack, subniv, Treatment.list, path, rasterDF, duration.dataframe, df, spg, i)
rm(end.time, j, start.time, write.path)


#############################
#######   House 3  ##########
#############################

# Since I have 4 different measures to do this for (mean, median, min, and max [of the 50 bootstrapped samples for daily
# minimum temperature]), make a loop

# Path of the summary folders
base.path <- "01_Analysis/Spatial Predictions/Summaries/House 3"
# base.path <- "Y:/kthompson/Ch 4 Bumblebees/Spatial Predictions/Corrected Daily Summaries/Corrected House 3/"
base.list <- list.files(base.path, pattern = "M")

# Path to write resulting raster stacks and final raster
write.path <- "01_Analysis/Spatial Predictions/Species Vulnerability/Bumblebees"
# write.path <- "Y:/kthompson/Ch 4 Bumblebees/Spatial Predictions/Species Sensitivities/Bumblebees/"


# Determining sensitivity based on SCP
start.time <- Sys.time()

for (j in 1:4) { # Number of summary measures to calculate for
  
  path <- paste(base.path, base.list[[j]], sep = "")
  Treatment.list <- list.files(path, pattern = "X")
  
  # Make a blank raster to store the altered layers in
  newstack <- stack()
  
  for (i in 1:length(Treatment.list)) {
    
    # Read in the daily raster
    setwd(path)
    subniv <- raster :: raster(Treatment.list[[i]])
    
    # Reclassify the raster
    subniv[subniv >= -6.7] <- 0
    subniv[subniv < -6.7] <- 1
    
    # Add the reclassified layer to the blank raster stack for this treatment
    newstack <- addLayer(newstack, subniv)
    
    print(i)
    
  }
  
  # I have this in here to be thorough but I don't think I need to have the whole raster stack written
  # It takes a huge amount of processing time to write such large stacks
  # Write the resulting raster stack
  # setwd(paste(write.path, "Reclassified Stacks", sep=""))
  # writeRaster(newstack, paste("SCP_Bombus_", base.list[[j]], "_H3 Daily Stack.tif", sep = ""), overwrite = TRUE)
  
  
  # Sum all of the layers to get a spatially-explicit measure of how many days the temps was below the SCP
  # Each cell's values will represent the number of days that the temp was below the SCP
  # true lakes which would have NA values for all days will have value of 0 which is incorrect though
  duration <- overlay(newstack, fun=sum.na)
  
  # Convert duration to a dataframe
  duration.dataframe <- as.data.frame(duration, xy=TRUE)
  
  # Merge the two dataframes together
  df <- merge(duration.dataframe, separating.lakes, by.x = c("x", "y"), by.y = c("x", "y"), all=TRUE)
  
  # Change layer.x value to NA where layer.y value is 605
  df$layer.x[df$layer.y == 6050] <- NA
  
  # Remove layer.y column
  df$layer.y <- NULL
  
  # Convert this dataframe to a raster
  # create spatial points data frame
  spg <- df
  coordinates(spg) <- ~ x + y
  # coerce to SpatialPixelsDataFrame
  gridded(spg) <- TRUE
  # coerce to raster
  rasterDF <- raster(spg)
  
  # Define the coordinate system
  crs(rasterDF) <- "+proj=aea +lat_0=23 +lon_0=-96 +lat_1=29.5 +lat_2=45.5 +x_0=0 +y_0=0 +ellps=GRS80 +datum=WGS84 +units=m +no_defs"
  
  # Write the resulting raster layer
  setwd(write.path)
  writeRaster(rasterDF, paste("SCP_Bombus_Worst Case_", base.list[[j]], "_3C warmer.tif", sep = ""), overwrite = TRUE)
  
  print(j)
  
} # Close j loop

end.time <- Sys.time()
end.time - start.time


# Clean up workspace before beginning on next treament
rm(base.list, base.path, duration, newstack, subniv, Treatment.list, path, rasterDF, duration.dataframe, df, spg, i)
rm(end.time, j, start.time, write.path)


#############################
#######   House 5  ##########
#############################

# Since I have 4 different measures to do this for (mean, median, min, and max [of the 50 bootstrapped samples for daily
# minimum temperature]), make a loop

# Path of the summary folders
base.path <- "01_Analysis/Spatial Predictions/Summaries/House 5"
# base.path <- "Y:/kthompson/Ch 4 Bumblebees/Spatial Predictions/Corrected Daily Summaries/Corrected House 5/"
base.list <- list.files(base.path, pattern = "M")

# Path to write resulting raster stacks and final raster
write.path <- "01_Analysis/Spatial Predictions/Species Vulnerability/Bumblebees"
# write.path <- "Y:/kthompson/Ch 4 Bumblebees/Spatial Predictions/Species Sensitivities/Bumblebees/"


# Determining sensitivity based on SCP
start.time <- Sys.time()

for (j in 1:4) { # Number of summary measures to calculate for
  
  path <- paste(base.path, base.list[[j]], sep = "")
  Treatment.list <- list.files(path, pattern = "X")
  
  # Make a blank raster to store the altered layers in
  newstack <- stack()
  
  for (i in 1:length(Treatment.list)) {
    
    # Read in the daily raster
    setwd(path)
    subniv <- raster :: raster(Treatment.list[[i]])
    
    # Reclassify the raster
    subniv[subniv >= -6.7] <- 0
    subniv[subniv < -6.7] <- 1
    
    # Add the reclassified layer to the blank raster stack for this treatment
    newstack <- addLayer(newstack, subniv)
    
    print(i)
    
  }
  
  # I have this in here to be thorough but I don't think I need to have the whole raster stack written
  # It takes a huge amount of processing time to write such large stacks
  # Write the resulting raster stack
  # setwd(paste(write.path, "Reclassified Stacks", sep=""))
  # writeRaster(newstack, paste("SCP_Bombus_", base.list[[j]], "_H5 Daily Stack.tif", sep = ""), overwrite = TRUE)
  
  
  # Sum all of the layers to get a spatially-explicit measure of how many days the temps was below the SCP
  # Each cell's values will represent the number of days that the temp was below the SCP
  # true lakes which would have NA values for all days will have value of 0 which is incorrect though
  duration <- overlay(newstack, fun=sum.na)
  
  # Convert duration to a dataframe
  duration.dataframe <- as.data.frame(duration, xy=TRUE)
  
  # Merge the two dataframes together
  df <- merge(duration.dataframe, separating.lakes, by.x = c("x", "y"), by.y = c("x", "y"), all=TRUE)
  
  # Change layer.x value to NA where layer.y value is 605
  df$layer.x[df$layer.y == 6050] <- NA
  
  # Remove layer.y column
  df$layer.y <- NULL
  
  # Convert this dataframe to a raster
  # create spatial points data frame
  spg <- df
  coordinates(spg) <- ~ x + y
  # coerce to SpatialPixelsDataFrame
  gridded(spg) <- TRUE
  # coerce to raster
  rasterDF <- raster(spg)
  
  # Define the coordinate system
  crs(rasterDF) <- "+proj=aea +lat_0=23 +lon_0=-96 +lat_1=29.5 +lat_2=45.5 +x_0=0 +y_0=0 +ellps=GRS80 +datum=WGS84 +units=m +no_defs"
  
  # Write the resulting raster layer
  setwd(write.path)
  writeRaster(rasterDF, paste("SCP_Bombus_Worst Case_", base.list[[j]], "_5C warmer.tif", sep = ""), overwrite = TRUE)
  
  print(j)
  
} # Close j loop

end.time <- Sys.time()
end.time - start.time


# Clean up workspace before beginning on next treament
rm(base.list, base.path, duration, newstack, subniv, Treatment.list, path, rasterDF, duration.dataframe, df, spg, i)


=======
######################################################################################
###########      Supercooling point - Reclassifying and calculating   ################
###########         the # of days the ground temp went below          ################
###########                 the SCP of bumblebees                     ################
######################################################################################

# Author: Kimberly Thompson

# This script calculates the number of days below the upper limit of the supercooling
# point for Bombus terrestis - WORST-CASE scenario, for 3 different treatments:
# external / current conditions, +3C, and +5C.

# This done for the mean, median, min and max predicted values of ground temperatures
# however only the mean is used in the analysis.

# Rasters produced:
# "SCP_Bombus_Worst Case_Mean_External.tif"
# "SCP_Bombus_Worst Case_Mean_3C warmer.tif"
# "SCP_Bombus_Worst Case_Mean_5C warmer.tif"

# Clear workspace
rm(list = ls() ) 
gc() #releases memory

library(raster)
library(sp)
library(lubridate)


#########################################################################
#############              Changing Cell values          ################
#########################################################################

# From Owen et al. 2013, the SCP of Bombus terrestris audax queens was found to be -7C +/- 0.3. 
# worst case is -6.7

# From the corrected dailies predictions of minimum temperature, read in each file, and resample so that if the values
# are -6.7 or above, the cell gets a 0, if the value is lower than -6.7 it gets a 1.

# Create sum function that would not take into account NAs


sum.na <- function (x) {
  sum(x, na.rm=TRUE)
}



#### Read in the separating lakes file ###
setwd("01_Analysis/Spatial Predictions")
# setwd("Y:/kthompson/Ch 4 Bumblebees/Spatial Predictions/Species Sensitivities")
separating.lakes <- read.csv("Separating Lakes.csv", header = TRUE)






#############################
#######  External  ##########
#############################

# Since I have 4 different measures to do this for (mean, median, min, and max [of the 50 bootstrapped samples for daily
# minimum temperature]), make a loop

# Path of the summary folders
base.path <- "01_Analysis/Spatial Predictions/Summaries/External"
# base.path <- "Y:/kthompson/Ch 4 Bumblebees/Spatial Predictions/Corrected Daily Summaries/External/"
base.list <- list.files(base.path, pattern = "M")

# Path to write resulting raster stacks and final raster
write.path <- "01_Analysis/Spatial Predictions/Species Vulnerability/Bumblebees"
# write.path <- "Y:/kthompson/Ch 4 Bumblebees/Spatial Predictions/Species Sensitivities/Bumblebees/Worst Case/"


# Determining sensitivity based on SCP
start.time <- Sys.time()

for (j in 1:4) { # Number of summary measures to calculate for
  
  path <- paste(base.path, base.list[[j]], sep = "")
  Treatment.list <- list.files(path, pattern = "X")
  
  # Make a blank raster to store the altered layers in
  newstack <- stack()
  
  for (i in 1:length(Treatment.list)) {
    
    # Read in the daily raster
    setwd(path)
    subniv <- raster :: raster(Treatment.list[[i]])
    
    # Reclassify the raster
    subniv[subniv >= -6.7] <- 0
    subniv[subniv < -6.7] <- 1
    
    # Add the reclassified layer to the blank raster stack for this treatment
    newstack <- addLayer(newstack, subniv)
    
    print(i)
    
  }

  # I have this in here to be thorough but I don't think I need to have the whole raster stack written
  # It takes a huge amount of processing time to write such large stacks
  # Write the resulting raster stack
  # setwd(paste(write.path, "Reclassified Stacks", sep=""))
  # writeRaster(newstack, paste("SCP_Bombus_", base.list[[j]], "_External Daily Stack.tif", sep = ""), overwrite = TRUE)

  
  # Sum all of the layers to get a spatially-explicit measure of how many days the temps was below the SCP
  # Each cell's values will represent the number of days that the temp was below the SCP
  # true lakes which would have NA values for all days will have value of 0 which is incorrect though
  duration <- overlay(newstack, fun=sum.na)
  
  # Convert duration to a dataframe
  duration.dataframe <- as.data.frame(duration, xy=TRUE)
  
  # Merge the two dataframes together
  df <- merge(duration.dataframe, separating.lakes, by.x = c("x", "y"), by.y = c("x", "y"), all=TRUE)
  
  # Change layer.x value to NA where layer.y value is 605
  df$layer.x[df$layer.y == 6050] <- NA

  # Remove layer.y column
  df$layer.y <- NULL
  
  # Convert this dataframe to a raster
  # create spatial points data frame
  spg <- df
  coordinates(spg) <- ~ x + y
  # coerce to SpatialPixelsDataFrame
  gridded(spg) <- TRUE
  # coerce to raster
  rasterDF <- raster(spg)
  
  # Define the coordinate system
  crs(rasterDF) <- "+proj=aea +lat_0=23 +lon_0=-96 +lat_1=29.5 +lat_2=45.5 +x_0=0 +y_0=0 +ellps=GRS80 +datum=WGS84 +units=m +no_defs"
  
  # Write the resulting raster layer
  setwd(write.path)
  writeRaster(rasterDF, paste("SCP_Bombus_Worst Case_", base.list[[j]], "_External.tif", sep = ""), overwrite = TRUE)
  
  print(j)
  
} # Close j loop

end.time <- Sys.time()
end.time - start.time
  

# Clean up workspace before beginning on next treament
rm(base.list, base.path, duration, newstack, subniv, Treatment.list, path, rasterDF, duration.dataframe, df, spg, i)
rm(end.time, j, start.time, write.path)


#############################
#######   House 3  ##########
#############################

# Since I have 4 different measures to do this for (mean, median, min, and max [of the 50 bootstrapped samples for daily
# minimum temperature]), make a loop

# Path of the summary folders
base.path <- "01_Analysis/Spatial Predictions/Summaries/House 3"
# base.path <- "Y:/kthompson/Ch 4 Bumblebees/Spatial Predictions/Corrected Daily Summaries/Corrected House 3/"
base.list <- list.files(base.path, pattern = "M")

# Path to write resulting raster stacks and final raster
write.path <- "01_Analysis/Spatial Predictions/Species Vulnerability/Bumblebees"
# write.path <- "Y:/kthompson/Ch 4 Bumblebees/Spatial Predictions/Species Sensitivities/Bumblebees/"


# Determining sensitivity based on SCP
start.time <- Sys.time()

for (j in 1:4) { # Number of summary measures to calculate for
  
  path <- paste(base.path, base.list[[j]], sep = "")
  Treatment.list <- list.files(path, pattern = "X")
  
  # Make a blank raster to store the altered layers in
  newstack <- stack()
  
  for (i in 1:length(Treatment.list)) {
    
    # Read in the daily raster
    setwd(path)
    subniv <- raster :: raster(Treatment.list[[i]])
    
    # Reclassify the raster
    subniv[subniv >= -6.7] <- 0
    subniv[subniv < -6.7] <- 1
    
    # Add the reclassified layer to the blank raster stack for this treatment
    newstack <- addLayer(newstack, subniv)
    
    print(i)
    
  }
  
  # I have this in here to be thorough but I don't think I need to have the whole raster stack written
  # It takes a huge amount of processing time to write such large stacks
  # Write the resulting raster stack
  # setwd(paste(write.path, "Reclassified Stacks", sep=""))
  # writeRaster(newstack, paste("SCP_Bombus_", base.list[[j]], "_H3 Daily Stack.tif", sep = ""), overwrite = TRUE)
  
  
  # Sum all of the layers to get a spatially-explicit measure of how many days the temps was below the SCP
  # Each cell's values will represent the number of days that the temp was below the SCP
  # true lakes which would have NA values for all days will have value of 0 which is incorrect though
  duration <- overlay(newstack, fun=sum.na)
  
  # Convert duration to a dataframe
  duration.dataframe <- as.data.frame(duration, xy=TRUE)
  
  # Merge the two dataframes together
  df <- merge(duration.dataframe, separating.lakes, by.x = c("x", "y"), by.y = c("x", "y"), all=TRUE)
  
  # Change layer.x value to NA where layer.y value is 605
  df$layer.x[df$layer.y == 6050] <- NA
  
  # Remove layer.y column
  df$layer.y <- NULL
  
  # Convert this dataframe to a raster
  # create spatial points data frame
  spg <- df
  coordinates(spg) <- ~ x + y
  # coerce to SpatialPixelsDataFrame
  gridded(spg) <- TRUE
  # coerce to raster
  rasterDF <- raster(spg)
  
  # Define the coordinate system
  crs(rasterDF) <- "+proj=aea +lat_0=23 +lon_0=-96 +lat_1=29.5 +lat_2=45.5 +x_0=0 +y_0=0 +ellps=GRS80 +datum=WGS84 +units=m +no_defs"
  
  # Write the resulting raster layer
  setwd(write.path)
  writeRaster(rasterDF, paste("SCP_Bombus_Worst Case_", base.list[[j]], "_3C warmer.tif", sep = ""), overwrite = TRUE)
  
  print(j)
  
} # Close j loop

end.time <- Sys.time()
end.time - start.time


# Clean up workspace before beginning on next treament
rm(base.list, base.path, duration, newstack, subniv, Treatment.list, path, rasterDF, duration.dataframe, df, spg, i)
rm(end.time, j, start.time, write.path)


#############################
#######   House 5  ##########
#############################

# Since I have 4 different measures to do this for (mean, median, min, and max [of the 50 bootstrapped samples for daily
# minimum temperature]), make a loop

# Path of the summary folders
base.path <- "01_Analysis/Spatial Predictions/Summaries/House 5"
# base.path <- "Y:/kthompson/Ch 4 Bumblebees/Spatial Predictions/Corrected Daily Summaries/Corrected House 5/"
base.list <- list.files(base.path, pattern = "M")

# Path to write resulting raster stacks and final raster
write.path <- "01_Analysis/Spatial Predictions/Species Vulnerability/Bumblebees"
# write.path <- "Y:/kthompson/Ch 4 Bumblebees/Spatial Predictions/Species Sensitivities/Bumblebees/"


# Determining sensitivity based on SCP
start.time <- Sys.time()

for (j in 1:4) { # Number of summary measures to calculate for
  
  path <- paste(base.path, base.list[[j]], sep = "")
  Treatment.list <- list.files(path, pattern = "X")
  
  # Make a blank raster to store the altered layers in
  newstack <- stack()
  
  for (i in 1:length(Treatment.list)) {
    
    # Read in the daily raster
    setwd(path)
    subniv <- raster :: raster(Treatment.list[[i]])
    
    # Reclassify the raster
    subniv[subniv >= -6.7] <- 0
    subniv[subniv < -6.7] <- 1
    
    # Add the reclassified layer to the blank raster stack for this treatment
    newstack <- addLayer(newstack, subniv)
    
    print(i)
    
  }
  
  # I have this in here to be thorough but I don't think I need to have the whole raster stack written
  # It takes a huge amount of processing time to write such large stacks
  # Write the resulting raster stack
  # setwd(paste(write.path, "Reclassified Stacks", sep=""))
  # writeRaster(newstack, paste("SCP_Bombus_", base.list[[j]], "_H5 Daily Stack.tif", sep = ""), overwrite = TRUE)
  
  
  # Sum all of the layers to get a spatially-explicit measure of how many days the temps was below the SCP
  # Each cell's values will represent the number of days that the temp was below the SCP
  # true lakes which would have NA values for all days will have value of 0 which is incorrect though
  duration <- overlay(newstack, fun=sum.na)
  
  # Convert duration to a dataframe
  duration.dataframe <- as.data.frame(duration, xy=TRUE)
  
  # Merge the two dataframes together
  df <- merge(duration.dataframe, separating.lakes, by.x = c("x", "y"), by.y = c("x", "y"), all=TRUE)
  
  # Change layer.x value to NA where layer.y value is 605
  df$layer.x[df$layer.y == 6050] <- NA
  
  # Remove layer.y column
  df$layer.y <- NULL
  
  # Convert this dataframe to a raster
  # create spatial points data frame
  spg <- df
  coordinates(spg) <- ~ x + y
  # coerce to SpatialPixelsDataFrame
  gridded(spg) <- TRUE
  # coerce to raster
  rasterDF <- raster(spg)
  
  # Define the coordinate system
  crs(rasterDF) <- "+proj=aea +lat_0=23 +lon_0=-96 +lat_1=29.5 +lat_2=45.5 +x_0=0 +y_0=0 +ellps=GRS80 +datum=WGS84 +units=m +no_defs"
  
  # Write the resulting raster layer
  setwd(write.path)
  writeRaster(rasterDF, paste("SCP_Bombus_Worst Case_", base.list[[j]], "_5C warmer.tif", sep = ""), overwrite = TRUE)
  
  print(j)
  
} # Close j loop

end.time <- Sys.time()
end.time - start.time


# Clean up workspace before beginning on next treament
rm(base.list, base.path, duration, newstack, subniv, Treatment.list, path, rasterDF, duration.dataframe, df, spg, i)


>>>>>>> f71b9b43c2ce4a4993c0575a12ed45b45c29af71
